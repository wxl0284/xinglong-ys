<!doctype html>
<html>
<head>
	<meta charset='utf-8'>
	<title>云量图片查询</title>
    {load href='/static/plugin/easyui-1.3.5/themes/default/easyui.css'}
    {load href='/static/plugin/easyui-1.3.5/jquery.min.js'}
	<!-- {load href='/static/plugin/easyui-1.3.5/themes/icon.css'} -->
	{load href='/static/plugin/easyui-1.3.5/jquery.easyui.min.js'}
    {load href='/static/plugin/easyui-1.3.5/locale/easyui-lang-zh_TW.js'}
    {load href='/static/plugin/layer/layer.js'}
    {load href='/static/css/common-1.css'}
    {load href='/static/js/weatherDetail.js'}
    <style>
        .cloud_pic {width:48%; margin-left: 1.2%;}
    </style>
</head>
<body>
	<img src='/static/images-1/top.jpg' style='width:100%'/>
	{include file="common/common"/}
	<div id='all' class='border'>
		<span style="display:block;margin:0 auto;width:50;text-align:center;" >
            <input id='date' type="text" >&nbsp;&nbsp;&nbsp;
            <input id='sbmt' type="button" value="确  定" style='line-height: 26px;'>
            <!-- <input id='hours_12' type="button" value="12小时数据曲线" >&nbsp;&nbsp;&nbsp;
            <input id='hours_24' type="button" value="24小时数据曲线" > -->
        </span>
        <br>
        {if condition="is_string($cloud_pic) && $cloud_pic == '未获取到'"}
            <h3 style="text-align:center;">未获取到云量图片</h3>
        {else /}
            {foreach name="cloud_pic" item="v"}
                <img src='/{$cloud_pic_dir}{$v}' class='cloud_pic'>
            {/foreach}
        {/if}
	</div><br>
	<footer class='center' style="width:100%;position:fixed;bottom:0;">
		<span>中科院国家天文台兴隆观测基地</span>
	</footer>
</body>
<script>
   $(function() {
       var date_box = $('#date');
       var sbmt = $('#sbmt');

       date_box.datebox({ //datebox开始
            // onSelect: function(date){
            // },
            editable: false,
            required: true,
            formatter: function(date){
                let y = date.getFullYear();
                let m = date.getMonth()+1;
                let d = date.getDate();
                return y + '/' + m + '/' + d ;
            },
            parser: function (s){
                if (!s) return new Date();  
                let ss = (s.split('-'));
                // let y = parseInt(ss[0],10); 
                // let m = parseInt(ss[1],10);
                // let d = parseInt(ss[2],10);
                let y = parseInt(ss[0]);
                let m = parseInt(ss[1]);
                let d = parseInt(ss[2]);
                if (!isNaN(y) && !isNaN(m) && !isNaN(d)){
                    return new Date(y,m-1,d);
                }else{
                    return new Date();
                }
            },
        })////datebox 结束

        var d = localStorage.getItem('day');
        if ( d )
        {
            let dd = d.split('/');
            dd = dd[0] + '-' + dd[1] + '-' + dd[2];
            date_box.datebox('setValue', dd); //此处的赋值需要与上面parser方法一致
        }else{
            let d = new Date();
            let y = d.getFullYear();
            let m = d.getMonth() +1;
            let dd = d.getDate();
            date_box.datebox('setValue', y + '-' + m + '-' + dd);
        }

        date_box.datebox('calendar').calendar({
            validator: function(date){
                let now = new Date();
                let d1 = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                return date <= d1; //不能选择未来
               /* 只能选择今天及10之内的
                let now = new Date();
                let d1 = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                let d2 = new Date(now.getFullYear(), now.getMonth(), now.getDate()+10);
                return d1<=date && date<=d2;*/
            }
        }) //不能选择未来 结束

        sbmt.click( function () {
            var day = date_box.datebox('getValue');
            let patn = /^\d{4}\/\d{1,2}\/\d{1,2}$/;

           if ( day.length < 8 || !patn.test(day) )
           {
               layer.alert('日期选择有误!', {shade:0, closeBtn:0});
           }else{
               localStorage.setItem('day', day);
               location.href = '/weather/clouds?date=' + day;
           }
        })
   })//jquery末尾
</script>
</html>